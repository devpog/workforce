{
    "contents" : "db_project_get_resources <- function(host, port = 9160, keyspace){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  query <- paste0(\"select * from name_resource\")\n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_project_get_clients <- function(host, port = 9160, keyspace, hub = NULL){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  if(!is.null(hub)){\n    query <- paste0(\"select * from hub_client where hub = \\'\", hub, \"\\'\")\n  } else {\n    query <- paste0(\"select * from hub_client\")\n  }\n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_get_project_details <- function(host, port = 9160, keyspace, client, phase){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from project where client =\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  project <- as.data.frame(dbGetQuery(conn, query))\n  \n  query <- paste0(\"select * from hub_client\")\n  hub_client <- as.data.frame(dbGetQuery(conn, query))\n  \n  query <- paste0(\"select * from role_project where client =\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  role_project <- as.data.frame(dbGetQuery(conn, query))\n  \n  query <- paste0(\"select * from dedication_project where client =\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  dedication_project <- as.data.frame(dbGetQuery(conn, query))\n  \n  query <- paste0(\"select * from resource_project where client =\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  resource_project <- as.data.frame(dbGetQuery(conn, query))\n  \n  query <- paste0(\"select * from name_resource\")\n  name_resource <- as.data.frame(dbGetQuery(conn, query))\n  \n  query <- paste0(\"select * from hub_resource\")\n  hub_resource <- as.data.frame(dbGetQuery(conn, query))\n  \n  dbDisconnect(conn)\n  \n  df <- join(resource_project, hub_client)\n  df <- left_join(df, name_resource, \"system_name\")\n\n  df[is.na(df)] <- \"None\"\n  df <- left_join(df, hub_resource, \"system_name\") %>% \n    transmute(hub_client = hub.x, hub_resource = ifelse(is.na(hub.y), hub.x, hub.y), client, role, system_name, last_name, first_name)\n  \n  df <- left_join(df, dedication_project, \"role\") %>% \n    transmute(hub_client, client = client.x, phase, role, hub_resource, system_name, first_name, last_name, dedication)\n\n  df <- left_join(df, project, \"client\") %>%\n    transmute(hub_client, client, phase = phase.x, \n              start_date = as.Date(strptime(start_date, format = \"%a\")), \n              end_date = as.Date(strptime(end_date, format = \"%a\")), \n              active, completed,\n              role, hub_resource,\n              system_name, full_name = paste(first_name, last_name), \n              dedication)\n  return(df)\n}\n\ndb_get_active_projects <- function(host, port = 9160, keyspace){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  query <- paste0(\"select * from project where active = true\")\n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  return(df)\n}\n\ndb_project_get_full_name <- function(host, port = 9160, keyspace, system_names){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  df <- data.frame()\n  for(system_name in system_names){\n    query <- paste0(\"select * from name_resource where system_name = \\'\", system_name, \"\\'\")\n    df <- rbind(df, as.data.frame(dbGetQuery(conn, query)))\n  }\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_project_get_resource <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  phase <- db_project_get_phase_2(host, port, keyspace, client)[, \"phase\"]\n  query <- paste0(\"select * from resource_project where client = \", \n                  \"\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_project_get_dedication <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  phase <- db_project_get_phase_2(host, port, keyspace, client)[, \"phase\"]\n  query <- paste0(\"select * from dedication_project where client = \", \n                  \"\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_project_get_phase_2 <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from project where client = \\'\", client, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_project_get_role <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  phase <- db_project_get_phase_2(host, port, keyspace, client)[, \"phase\"]\n  query <- paste0(\"select * from role_project where client = \", \n                  \"\\'\", client, \"\\' and phase = \\'\", phase, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  return(df)\n}\n\ndb_project_get_active <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from project where client = \", \n                  \"\\'\", client, \"\\' and completed = false\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))[, \"active\"]\n  dbDisconnect(conn)\n  if(df == 'true')\n    return(TRUE)\n  else if(df == 'false')\n    return(FALSE)\n}\n\ndb_project_get_phase <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from project where client = \", \n                  \"\\'\", client, \"\\' and completed = false\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))[, \"phase\"]\n  dbDisconnect(conn)\n  return(df)\n}\n\ndb_project_get_start_date <- function(host, port = 9160, keyspace, client, phase){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from project where client = \", \n                  \"\\'\", client, \"\\'\", \n                  \" and phase = \\'\", phase, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))[, \"start_date\"]\n  dbDisconnect(conn)\nreturn(df)\n}\n\ndb_project_get_end_date <- function(host, port = 9160, keyspace, client, phase){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from project where client = \", \n                  \"\\'\", client, \"\\'\", \n                  \" and phase = \\'\", phase, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))[, \"end_date\"]\n  dbDisconnect(conn)\nreturn(df)\n}\n\ndb_get_resources <- function(host, port = 9160, keyspace, role){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from resource where role = \\'\", role, \"\\'\")\n  \n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  return(df)\n}\n\ndb_get_hubs_from_client <- function(host, port = 9160, keyspace, client){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  query <- paste0(\"select hub from client where client = \\'\", client, \"\\'\")\n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  return(df[, \"hub\"])\n}\n\ndb_read_table_project <- function(host, port = 9160, keyspace, all = T){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  if(all){\n    query <- paste0('select * from project')\n  } else {\n    query <- paste0('select client from project')\n  }\n  \n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  if(!project_show_all_phases()){\n    df <- filter(df, phase == project_phase())\n  }\n  \n  if(project_show_all_active()){\n    df <- filter(df, active == \"true\")\n  }\n  \n  if(project_show_all_completed()){\n    df <- filter(df, completed == \"true\")\n  }\n  \nreturn(df)\n}\n\ndb_read_table_project_by_hub <- function(host, port = 9160, keyspace, hub){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\"select * from hub_client where hub = \\'\", hub, \"\\'\")\n  clients <- as.data.frame(dbGetQuery(conn, query))[, \"client\"]\n  \n  query <- paste0(\"select * from project where client in (\\'\", paste(clients, collapse = \"\\',\\'\", sep = \"\\'\"), \"\\')\")\n  df <- as.data.frame(dbGetQuery(conn, query))\n  dbDisconnect(conn)\n  \n  if(!project_show_all_phases()){\n    df <- filter(df, phase == project_phase())\n  }\n  \n  if(project_show_all_active()){\n    df <- filter(df, active == \"true\")\n  }\n  \n  if(project_show_all_completed()){\n    df <- filter(df, completed == \"true\")\n  }\n  \nreturn(df)\n}\n\ndb_insert_row_project <- function(host, port = 9160, keyspace, client, phase, start_date, end_date, active){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n\n  if(!is.null(end_date)){\n    d_start <- as.Date(start_date)\n    d_end <- as.Date(end_date)\n    d_today <- Sys.Date()\n    if(d_today > end_date)\n      completed <- \"true\"\n    else\n      completed <- \"false\"\n  }\n  \n  query <- paste0(\n    \"insert into project (client, phase, start_date, end_date, active, completed) values (\", \n    \"\\'\", client, \"\\', \",\n    \"\\'\", phase, \"\\', \",\n    \"\\'\", start_date, \"\\', \",\n    \"\\'\", end_date, \"\\', \",\n    active, \", \",\n    completed, \")\")\n\n  dbSendUpdate(conn, query)\n  dbDisconnect(conn)\n}\n\ndb_insert_row_pr_dedication <- function(host, port = 9160, keyspace, client, phase, role, dedication){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\n    \"insert into dedication_project (client, phase, role, dedication) values (\",\n    \"\\'\", client, \"\\', \",\n    \"\\'\", phase, \"\\', \",\n    \"\\'\", role, \"\\', \",\n    dedication, \")\")\n  \n  dbSendUpdate(conn, query)\n  dbDisconnect(conn)\n}\n\ndb_insert_row_pr_role <- function(host, port = 9160, keyspace, client, phase, role, count){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  query <- paste0(\n    \"insert into role_project (client, phase, role, count) values (\",\n    \"\\'\", client, \"\\', \",\n    \"\\'\", phase, \"\\', \",\n    \"\\'\", role, \"\\', \",\n    count, \")\")\n  \n  dbSendUpdate(conn, query)\n  dbDisconnect(conn)\n}\n\ndb_insert_row_pr_resource <- function(host, port = 9160, keyspace, client, phase, full_name, role){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  \n  if(full_name != \"None\"){\n    full_name <- str_trim(unlist(str_split(full_name, \",\")), \"both\")\n    query <- paste0(\n      \"select * from name_resource where first_name = \\'\",\n      full_name[2], \"\\' and last_name = \\'\", full_name[1], \"\\'\")\n    system_name <- dbGetQuery(conn, query)[, \"system_name\"]\n  } else {\n    system_name <- full_name\n  }\n  \n  query <- paste0(\n    \"insert into resource_project (client, phase, system_name, role) values (\",\n    \"\\'\", client, \"\\', \",\n    \"\\'\", phase, \"\\', \",\n    \"\\'\", system_name, \"\\', \",\n    \"\\'\", role, \"\\')\")\n  \n  dbSendUpdate(conn, query)\n  dbDisconnect(conn)\n}\n\ndb_delete_row_project <- function(host, port = 9160, keyspace, name, hub){\n  drv <- JDBC(db_drv, jars)\n  conn <- dbConnect(drv, paste0(\"jdbc:cassandra://localhost:9160/\", keyspace))\n  query <- paste0(\"delete from project where project = \\'\", name, \"\\'\", \n                  \"and hub = \\'\", hub, \"\\'\")\n  \n  dbSendUpdate(conn, query)\n  dbDisconnect(conn)\n}",
    "created" : 1467298734560.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2598218047",
    "id" : "CD70C1CC",
    "lastKnownWriteTime" : 1467249333,
    "path" : "~/Documents/workforce/external/source/project/db.R",
    "project_path" : "external/source/project/db.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "type" : "r_source"
}